<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="teamMapper">	
	<!-- 가입팀 여부 확인 -->
	<select id="isMyTeam" parameterType="map" resultType="boolean">
		SELECT DECODE(
        	#{teamIdx }, (SELECT TEAM_IDX FROM TEAM_MEMBER
       		WHERE TEAM_IDX = #{teamIdx }
        	AND USERIDX = #{useridx } ), 1, 0) AS TF 
		FROM DUAL
	</select>
	
	<select id="isMyTeam2" parameterType="map" resultType="String">
		SELECT TEAM_IDX FROM TEAM_MEMBER
       	WHERE TEAM_IDX = #{teamIdx }
        AND USERIDX = #{useridx } 
	</select>

	<select id="getTotalCount" parameterType="String" resultType="int">
		SELECT COUNT(*) AS CNT FROM TEAM_BBS WHERE TEAM_IDX = #{teamIdx }
	</select>
	
	<select id="getBbsList" parameterType="map" resultType="com.sports.model.vo.TeamBbsVO">
	<![CDATA[
		SELECT  * 
		    FROM (SELECT ROWNUM AS RNUM, B.*
		        FROM (SELECT T.*, S.NICKNAME 
		        	FROM TEAM_BBS T, SPORT_USER S
					WHERE S.USERIDX = T.USERIDX
					AND T.TEAM_IDX = #{teamIdx}
					ORDER BY BBS_IDX DESC
				) B
			)
		WHERE RNUM >= #{begin } 
		    AND RNUM <= #{end }
	]]>
	</select>
	
	<select id="getOndBbs" parameterType="String" resultType="com.sports.model.vo.TeamBbsVO">
		SELECT T.*, S.NICKNAME FROM TEAM_BBS T, SPORT_USER S
		WHERE S.USERIDX = T.USERIDX
		AND T.BBS_IDX = #{bbsIdx }
	</select>
	
	<select id="getnewBbsIdx" resultType="String">
		SELECT SEQ_TEAM_BBS_IDX.NEXTVAL FROM DUAL
	</select>
	
	<insert id="insertBbs" parameterType="com.sports.model.vo.TeamBbsVO">
		INSERT INTO TEAM_BBS (BBS_IDX, USERIDX, TEAM_IDX, SUBJECT, CONTENT, WRITE_DATE, IMAGE_IDX, HIT)
		VALUES (#{bbsIdx }, #{useridx}, #{teamIdx}, #{subject}, #{content}, SYSDATE, #{imageIdx}, #{hit})
	</insert>
	
	<select id="getCommentsList" parameterType="String" resultType="Paging.CommentVO">
		SELECT T.*, S.NICKNAME FROM TEAM_COMMENTS T, SPORT_USER S
		WHERE S.USERIDX = T.USERIDX
		AND T.BBS_IDX = #{bbsIdx }
		ORDER BY COMMENT_IDX 
	</select>
	
	<insert id="insertComment" parameterType="Paging.CommentVO">
		INSERT INTO TEAM_COMMENTS (COMMENT_IDX, BBS_IDX, USERIDX, CONTENT, WRITE_DATE)
		VALUES (SEQ_TEAM_COMMENTS.NEXTVAL, #{bbsIdx }, #{useridx }, #{content },SYSDATE)
	</insert>
	
	
	
</mapper>














